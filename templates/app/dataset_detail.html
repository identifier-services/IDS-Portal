{% extends "base.html" %}

{% block content %}
    <h2>{{ verbose_name}} Detail</h2>

    <p>
    {% if object.root %}
        project owner:
        {{ object.root.owner }}
    {% endif %}
    </p>

    {% if graph %}
    <svg width="100%" height="100%" 
        viewBox="-20 -20 {{ graph.height}} {{ graph.width }}" 
        version="1.1" xmlns="http://www.w3.org/2000/svg">
        <style>
            /* <![CDATA[ */
            svg circle {
                fill: #F7FCFF;
                stroke: black;
                stroke-width: 2px;
            }
            svg a:hover {
                text-decoration: none;
            }
            svg text {
                font-family: 'Nunito Sans', Helvetica;
                font-size: 16px;
                font-weight: bold;
                fill: #555;
                text-anchor: middle;
            }
            svg text.itemCount {
                font-size: 65px;
                alignment-baseline: baseline;
                font-weight: bold;
                fill: #DFDFDF;
            }
            /* ]]> */
        </style>

        <defs>
            <marker id="right_arrow" markerWidth="6" markerHeight="6" 
                viewBox="0 -5 10 10" refX="0" refY="0" 
                orient="auto" markerUnits="strokeWidth">
                <path d="M0,-5L10,0L0,5 z" fill="#000" />
            </marker>

            <line id="right" x1="1" y1="0" x2="84" y2="0" stroke="#000" 
                stroke-width="3" marker-end="url(#right_arrow)" />
            <line id="left" x1="1" y1="0" x2="84" y2="0" stroke="#000" 
                stroke-width="3" transform="rotate(180, 51, 0)" 
                marker-end="url(#right_arrow)" />
            <line id="down" x1="1" y1="0" x2="84" y2="0" stroke="#000" 
                stroke-width="3" transform="rotate(90, 0, 0)" 
                marker-end="url(#right_arrow)" />
            <line id="up" x1="1" y1="0" x2="84" y2="0" stroke="#000" 
                stroke-width="3" transform="rotate(270, 51, 0)" 
                marker-end="url(#right_arrow)" />
        </defs>

        {% for node in graph.nodes %}
        <svg x="{{ node.x }}" y="{{ node.y }}" width="103" height="103">
            <clipPath id="nodeMask">
                <circle cx="50%" cy="50%" r="48"/>
            </clipPath>
            <a href="{{ node.url }}">
                <circle cx="50%" cy="50%" r="49"/>
                <text x="50%" y="72%" class="itemCount" 
                    clip-path="url(#nodeMask)">
                    {{ node.element_count }}
                </text>
                <text x="50%" y="55%" clip-path="url(#nodeMask)">
                    {{ node.element_type_name }}
                </text>
            </a>
        </svg>
        {% endfor %}
        {% for edge in graph.edges %}
            <use x="{{ edge.x }}" y="{{ edge.y }}" href="#{{ edge.direction }}"/>
        {% endfor %}
    </svg>
    {% endif %}

    {% if object.get_parent_relations %}
        <hr/>
        <h3>Parents:</h3>
        <ul>
            {% for parent_rel in object.get_parent_relations %}
                <li><b>{{ parent_rel.verbose_name|title }}:</b> 
                    <a href="{{ parent_rel.object.get_absolute_url }}">
                        {{ parent_rel.object.name }}
                    </a>
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    <hr/>
    <h3>Attributes:</h3>
    <ul>
        {% for field in object.get_fields %}
            <li><b>{{ field.label }}:</b> {{ field.value }}</li>
        {% endfor %}
    </ul>

    <hr/>
    <h3>Contents:</h3>
    <ul>
        {% for content in object.datasetlink_set.all %}
            <li><a href="{{ content.datum.get_absolute_url}}">{{ content.datum }}</a></li>
        {% endfor %}
    </ul>

    <a href="{{ object.get_absolute_url }}/update">Edit {{ verbose_name }}</a>
    <a href="{{ object.get_absolute_url }}/delete">Delete {{ verbose_name }}</a>
{% endblock %}
